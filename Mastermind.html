<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastermind</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a dark theme and game elements */
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior: none; /* Prevents pull-to-refresh */
        }

        /* Style for the small feedback pegs */
        .feedback-peg-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Default 2x2 grid for 4 pegs */
            grid-template-rows: repeat(2, 1fr);
            gap: 4px;
            width: 28px; /* Default for 4 pegs */
            height: 28px; /* Default for 4 pegs */
        }
        
        .feedback-peg {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: #4B5563; /* Dark gray for empty */
            border: 1px solid #6B7280;
        }

        /* Style for the guess pegs */
        .guess-peg {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: #374151; /* Darker gray for empty slot */
            border: 2px dashed #4B5563;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        /* Style for the color palette buttons */
        .color-btn {
            width: 36px; /* Slightly smaller for 8 colors in one row */
            height: 36px; /* Slightly smaller for 8 colors in one row */
            border-radius: 50%;
            border: 3px solid transparent;
            transition: all 0.2s ease;
        }
        
        .color-btn:hover {
            transform: scale(1.1);
        }
        
        .color-btn.selected {
            border-color: #3B82F6; /* Blue border for selected */
            transform: scale(1.1);
        }

        /* Active row highlight */
        .active-row {
            background-color: #374151; /* A slightly lighter shade to indicate active */
            border-color: #5E81AC; /* A subtle blue to highlight */
        }

        /* Custom scrollbar for modals */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 10px;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: #4B5563;
            border-radius: 10px;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }

        /* Toast notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #111827;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            border: 1px solid #374151;
            padding: 16px;
            position: fixed;
            z-index: 100;
            left: 50%;
            transform: translateX(-50%);
            bottom: 30px;
            opacity: 0;
            transition: visibility 0s 0.5s, opacity 0.5s linear, bottom 0.5s ease;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
            transition: visibility 0s 0s, opacity 0.5s linear, bottom 0.5s ease;
        }
    </style>
</head>
<body class="bg-gray-900 text-white p-4 flex flex-col items-center justify-start min-h-screen overscroll-none">

    <div class="w-full max-w-sm mx-auto">
        <!-- Header with Icons -->
        <div class="flex justify-between items-center mb-4">
            <button id="instructions-btn" class="text-gray-400 hover:text-white p-2 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            </button>
            <h1 class="text-3xl font-bold text-center text-gray-100">Mastermind</h1>
            <div class="flex space-x-2">
                <button id="analytics-btn" class="text-gray-400 hover:text-white p-2 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                </button>
                <button id="settings-btn" class="text-gray-400 hover:text-white p-2 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                </button>
            </div>
        </div>
        
        <!-- Streak Counter -->
        <div class="flex justify-center items-center space-x-2 mb-2 text-lg">
            <span class="text-gray-400">Streak:</span>
            <span id="current-streak" class="font-bold text-white">0</span>
            <span class="text-yellow-400">ðŸ”¥</span>
        </div>

        <!-- Secret Code (Hidden until game over) -->
        <div id="secret-code" class="flex justify-center space-x-2 mb-4 p-2 bg-gray-700 rounded-lg" style="display: none;">
            <!-- Secret pegs will be added here by JS -->
        </div>

        <!-- Game Board -->
        <div id="game-board" class="space-y-2 mb-4 border border-gray-700 rounded-lg p-2 bg-gray-800">
            <!-- Guess rows will be generated by JS -->
        </div>

        <!-- Color Palette -->
        <div id="color-palette" class="flex flex-row flex-wrap justify-center gap-2 mb-4 p-3 bg-gray-800 rounded-lg">
            <!-- Color buttons will be generated by JS -->
        </div>

        <!-- Controls -->
        <div class="grid grid-cols-3 gap-2">
            <button id="hint-btn" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold p-3 rounded-lg transition duration-200 flex justify-center items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 16.84c.425-.425.753-1.002 1.002-1.602m3.672-3.672c.6-.249 1.177-.577 1.602-1.002m-5.274 5.274l5.274-5.274M12 21a9 9 0 110-18 9 9 0 010 18z" /></svg>
            </button>
            <button id="submit-guess" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 col-span-1">
                Submit Guess
            </button>
            <button id="new-game-btn" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold p-3 rounded-lg transition duration-200 flex justify-center items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M1 4v6h6m16 10v-6h-6M20.49 9A9 9 0 007.8 6.93M3.51 15a9 9 0 0012.7 2.07" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Modals -->

    <!-- Generic Modal Wrapper -->
    <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50" style="display: none;">
        <!-- End Game Modal -->
        <div id="end-game-modal" class="bg-gray-800 p-6 rounded-lg shadow-xl text-center max-w-md w-full" style="display: none;">
            <h2 id="modal-title" class="text-2xl font-bold mb-4">You Won!</h2>
            <p id="modal-message" class="mb-4 text-lg">Congratulations, you cracked the code!</p>
            <div class="grid grid-cols-2 gap-2">
                <button id="modal-share" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    Share
                </button>
                <button id="modal-new-game" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    Play Again
                </button>
            </div>
        </div>

        <!-- Instructions Modal -->
        <div id="instructions-modal" class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full" style="display: none;">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">How to Play</h2>
                <button class="modal-close text-gray-400 hover:text-white">&times;</button>
            </div>
            <div class="space-y-4 text-gray-300 max-h-80 overflow-y-auto modal-content pr-2">
                <p>Guess the secret code in 10 tries or less.</p>
                <p>The code is a sequence of colors. Duplicates are allowed.</p>
                <p>After each guess, you'll get feedback:</p>
                <ul class="list-none space-y-2 pl-4">
                    <li class="flex items-center space-x-2">
                        <span class="w-4 h-4 rounded-full bg-white block"></span>
                        <span>= Correct color in the correct position.</span>
                    </li>
                    <li class="flex items-center space-x-2">
                        <span class="w-4 h-4 rounded-full bg-red-600 block"></span>
                        <span>= Correct color in the wrong position.</span>
                    </li>
                    <li class="flex items-center space-x-2">
                        <span class="w-4 h-4 rounded-full bg-gray-600 block"></span>
                        <span>= Incorrect color.</span>
                    </li>
                </ul>
                <p>Tap a color in the palette to add it to your guess. Tap a peg in the active row to remove it.</p>
                <p><strong>Hint:</strong> Use the <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 16.84c.425-.425.753-1.002 1.002-1.602m3.672-3.672c.6-.249 1.177-.577 1.602-1.002m-5.274 5.274l5.274-5.274M12 21a9 9 0 110-18 9 9 0 010 18z" /></svg> button once per game to reveal one correct peg. This will cost you a guess!</p>
                <p><strong>Hard Mode:</strong> If enabled, all your guesses must be consistent with the feedback from all previous turns.</p>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Settings</h2>
                <button class="modal-close text-gray-400 hover:text-white">&times;</button>
            </div>
            <div class="space-y-6 text-gray-300">
                <div class="flex justify-between items-center">
                    <label for="code-length" class="font-medium">Code Length</label>
                    <select id="code-length" class="bg-gray-700 text-white rounded-lg p-2">
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                    </select>
                </div>
                <div class="flex justify-between items-center">
                    <label for="color-count" class="font-medium">Number of Colors</label>
                    <select id="color-count" class="bg-gray-700 text-white rounded-lg p-2">
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>
                <div class="flex justify-between items-center">
                    <label for="hard-mode" class="font-medium">Hard Mode</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="hard-mode" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                <p class="text-sm text-gray-400">Note: Settings will apply to the next new game.</p>
            </div>
        </div>

        <!-- Analytics Modal -->
        <div id="analytics-modal" class="bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Statistics</h2>
                <button class="modal-close text-gray-400 hover:text-white">&times;</button>
            </div>
            <div class="flex justify-around text-center mb-6">
                <div>
                    <div id="stats-played" class="text-3xl font-bold">0</div>
                    <div class="text-sm text-gray-400">Played</div>
                </div>
                <div>
                    <div id="stats-win-pct" class="text-3xl font-bold">0</div>
                    <div class="text-sm text-gray-400">Win %</div>
                </div>
                <div>
                    <div id="stats-streak" class="text-3xl font-bold">0</div>
                    <div class="text-sm text-gray-400">Streak</div>
                </div>
                <div>
                    <div id="stats-max-streak" class="text-3xl font-bold">0</div>
                    <div class="text-sm text-gray-400">Max</div>
                </div>
            </div>
            <h3 class="text-lg font-bold text-center mb-4">Guess Distribution</h3>
            <div id="stats-distribution" class="space-y-2">
                <!-- Distribution bars will be generated here -->
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast">Copied results to clipboard!</div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Victory Messages ---
            const victoryMessages = [
                "ðŸ¤¯ You cracked the code! Quick, before the government finds out!",
                "ðŸŽ‰ The secret ingredient was always chaos. And you mastered it!",
                "ðŸ‘‘ Bow down, peons! The Mastermind has arrived!",
                "ðŸ§  My brain hurts just watching you. Well done!",
                "ðŸ¦„ You found the hidden unicorn in the haystack of logic!",
                "âœ¨ Did you just use magic? I suspect sorcery.",
                "ðŸ§¦ Winning is easy when you wear your lucky socks. (You were wearing lucky socks, right?)",
                "ðŸ¢ Slow and steady wins the race... but you just zoomed past the finish line!",
                "ðŸŽ¶ I hear an 8-bit fanfare playing just for you!",
                "Error: Logic overflow. You won too hard.",
                "ðŸŒ® Time for a celebratory taco. You earned it.",
                "You're a genius! (Don't tell anyone I said that.)",
                "Achievement Unlocked: Code Breaker Supreme!",
                "I'm calling the police. That level of brilliance is illegal.",
                "You're not just a mastermind, you're a... *masterpiece*.",
                "Did you cheat? (Just kidding! ...Mostly.)",
                "The algorithm weeps with joy/defeat.",
                "Guess who's the cleverest? You are! (Yes, you.)",
                "You've earned the right to gloat. Briefly.",
                "This win brought to you by coffee and pure determination.",
                "Victory smells like success... and a little bit like burnt toast.",
                "The stars aligned, and so did your pegs.",
                "A perfect deduction! Watson would be proud.",
                "You successfully resisted the urge to flip the board. Bravo.",
                "Your brain is full of glorious, colorful victory!",
                "The code has been apprehended and charged with being too easy for you.",
                "Now go forth and conquer a sandwich.",
                "Consider this pop-up your official certificate of awesomeness.",
                "I'm starting to think you peeked. Stop being so good!",
                "Woohoo! Time to do your victory dance.",
                "ðŸ•µï¸ Case closed! You've successfully investigated the secrets of the universe (or at least this game).",
                "ðŸŽ¤ Drop the mic! You just solved the unsolvable.",
                "ðŸ¥‡ You win! The trophy is currently being polished. Enjoy this digital hug instead.",
                "ðŸ’¡ Your brain just emitted a winning frequency.",
                "ðŸ¤¹ You juggle logic like a pro!",
                "ðŸª Well played! Have a digital cookie.",
                "ðŸ¤¯ I need to lie down. That was too intense. Good job!",
                "This is what happens when you combine luck with excessive intelligence.",
                "Whoa, that was a photo finish! (Just kidding, you totally dominated.)",
                "My processor is impressed. That's a high compliment.",
                "You have officially achieved 'Peak Problem Solver' status.",
                "We'll need to upgrade the difficulty settings just for you.",
                "The Mastermind doesn't just play the gameâ€”it **is** the game.",
                "Look at you, making excellent decisions and achieving great things!",
                "You're like a heat-seeking missile of logic.",
                "Don't stop now! There are still puzzles to solve (and snacks to eat).",
                "And the crowd goes wild! (The crowd is me, the computer.)",
                "Your intuition game is strong. Too strong, perhaps.",
                "Tell me your secrets! Wait, don't. That's classified.",
                "Your next challenge: finding where you put your keys.",
                "Congratulations! You remembered all the colors correctly!",
                "The hidden message was 'You Win!' and you decoded it perfectly.",
                "You, my friend, are a riddle wrapped in an enigma, solved by pure deduction.",
                "You didn't just play the game; you schooled it.",
                "If winning were a job, you'd be Employee of the Month.",
                "You are now officially a Certified Code Cracker (CCC).",
                "Victory! The perfect blend of focus and a little bit of hopeful guessing.",
                "You did it! *Confetti cannons deploy.*",
                "Consider your mind officially blown. By your own brilliance.",
                "That was spectacular. Take a bow!",
                "ðŸŒŸ You did it! A testament to **persistence** and keen observation.",
                "ðŸš€ Proof that you can figure out anything you put your mind to.",
                "ðŸ’ª Mistakes are just data points. You took that data and created **victory**.",
                "ðŸŒ± **Growth** happens when you challenge yourself. You crushed it!",
                "ðŸ’– Believe in your brilliance. Today, you made it shine.",
                "ðŸ”ï¸ You reached the summit of this challenge. Keep climbing!",
                "Your **focus** and attention to detail paid off beautifully.",
                "Every step forward, no matter how small, is progress. Today was a **giant leap**.",
                "This is what happens when you apply disciplined thought. **Well done**.",
                "You didn't give up. That's the real win.",
                "**Confidence** is quiet. Victory is loud. Hear that sound?",
                "Success is the sum of small efforts, repeated. **Congratulations**.",
                "The ability to learn is the greatest gift. You just unwrapped a win.",
                "Let this win be a reminder: **you are capable of great things**.",
                "You proved that logic triumphs over chaos.",
                "**Celebrate** this achievement. You worked hard for it.",
                "The courage to try is the key to all success.",
                "Turn your effort into excellence. **You are excellent!**",
                "You were patient, you were smart, and you **earned this**.",
                "Let your victory inspire your next great move.",
                "Winning isn't everything, but **learning how to win is**.",
                "Trust your process. It led you here.",
                "Your mind is a powerful tool. Use it often.",
                "This is what **determination** looks like.",
                "Victory isn't given; it's earned through **smart effort**.",
                "You solved the problem. Now go apply that mindset everywhere.",
                "You are the author of your own success story.",
                "Keep learning, keep challenging yourself, **keep winning**.",
                "What a beautiful display of intelligent guessing and masterful deduction.",
                "Success is knowing when to stop guessing and start **knowing**.",
                "The road was tricky, but your commitment was stronger.",
                "**Never underestimate** what you can achieve when you put your mind to it.",
                "You looked at the information and saw the **solution**.",
                "You took risks, and they paid off. **Bravo!**",
                "This victory is a milestone. What's the next one?",
                "You are smarter than you think. This game proves it.",
                "One challenge down. Ready for the world?",
                "**Inspiration** is found in the victories you create for yourself.",
                "You didn't just guess; you **reasoned** your way to the top.",
                "The moment you believed you could, you were already halfway there. **You won!**",
                "When life gives you lemonade, make lemons. Life will be all like, 'Whaaaaaat?!'",
                "Always look people in the eyes. Even if they're blind. Just say, 'I am looking you in the eyes.'",
                "If you get pulled over for speeding, tell the policeman your spouse has diarrhea.",
                "You only get one chance at a first impression. I suggest Julia Child, because it's easiest to do. ('Save the giblets!')",
                "The most amazing things that can happen to a human being will happen to you, if you just lower your expectations.",
                "Dance until your feet hurt. Sing until your lungs hurt. Act until you're William Hurt.",
                "Take a lesson from parakeets. If you're ever feeling lonely, just eat in front of a mirror.",
                "Marry someone who looks sexy disappointed.",
                "You can tell a lot about a person from their biography.",
                "Watch a sunrise at least once a day.",
                "If you love something, set it free. Unless it's a tiger.",
                "If you're ever in a jam, a crayon scrunched up under your nose makes a good pretend mustache.",
                "Older black ladies make the best iced tea.",
                "Never be afraid to reach for the stars because even if you fall, you'll always be wearing a Parentchute.",
                "If my son thinks of me as one of his idiot friends, I've succeeded as a dad.",
                "A happy kid is like an antidepressant. But a natural one, not the kind your husband has to find in your jewelry drawer.",
                "Think inside the box. That's right, I said inside. Because while everyone is chasing each other outside, you know what the box is? Empty.",
                "Give a kid a bird, and he becomes one of those weird dudes who walk around with a bird on their shoulder. But give him a pair of wings, he can flyâ€”unless he has absolutely no hand-eye coordination.",
                "Sometimes God closes a door, but sometimes he closes it so hard, you can't get your wife out.",
                "Success is 1% inspiration, 98% perspiration, and 2% attention to detail.",
                "If you're ever feeling down, just think of the three C's: Coffee, Cereal, and Comedy.",
                "If you want to be truly happy in life, surround yourself with people who make you laugh. And also, people who bring snacks.",
                "Always keep the rhythm in your feet and a little party in your shoulders.",
                "Act like a parent, talk like a peer. I call it peerrenting.",
                "Buy low, sell high. People are gonna see this and say, 'That guy's high.'",
                "Hip hip hip hurray, save the extra hip 'cause you're gonna need it someday!",
                "If you wanna fly, I'm not gonna hold your feet to the ground. I want to be the one to push you off the cliff.",
                "The world needs more dreamers. Never stop licking things.",
                "Slow is smooth, and smooth is fast.",
                "When it rains on your parade, dance. Youâ€™re wet anyway.",
                "A sandwich tastes better when someone else makes it, but a victory tastes best when you make it yourself.",
                "Always carry two pens: one to lend, one to pretend doesnâ€™t work.",
                "A day without laughter is like a day without Wi-Fi.",
                "Donâ€™t fear the unknownâ€”unless the unknown looks like a snake.",
                "The secret to success? A lot of trying and a little lying. Just kidding. Donâ€™t lie... unless you're playing poker.",
                "Sleep like no oneâ€™s watching. Snore like you just donâ€™t care.",
                "If youâ€™re lost in thought, at least youâ€™re somewhere interesting.",
                "Be the person who claps first, laughs hardest, and eats the last cookie.",
                "There's no 'I' in team, but thereâ€™s a 'ME' if you rearrange it.",
                "If your friendâ€™s joke fails, laugh louder. Itâ€™s charity.",
                "A family hug should be like a burrito: warm, tight, and comforting.",
                "If life gives you a tough situation, add glitter. Everythingâ€™s better with glitterâ€”except vacuuming.",
                "Want a stress-free life? Do yoga. Want a fun life? Do karaoke.",
                "Marriage is like a tandem bike. One of you pedals, the other rings the bell.",
                "Youâ€™re never too old to learn something new. Thatâ€™s why I watch YouTube.",
                "If at first you donâ€™t succeed, redefine success.",
                "Clothes are like friends: theyâ€™re better when they donâ€™t wrinkle.",
                "Sometimes you just have to look at a big problem and say, â€œNot today, Satan. Not today.â€",
                "A selfie is worth a thousand likes.",
                "Eat ice cream like itâ€™s melting. Because it is.",
                "Time flies when you're having funâ€”unless you're holding a plank.",
                "Never pass up free food. Itâ€™s food, and itâ€™s free.",
                "Dogs are manâ€™s best friend because they never judge your dance moves.",
                "Hugs are like band-aids for your soul.",
                "Worrying is like carrying an umbrella every day. Sure, youâ€™re prepared, but you look kinda ridiculous.",
                "Teach your kids to be kind. Also, teach them to mow the lawn.",
                "Always RSVP â€œyesâ€ to cake.",
                "If youâ€™re trying to impress someone, just smile. Teeth are like free accessories.",
                "Life isnâ€™t a race. Unless youâ€™re running. Then, yeah, it is.",
                "Turn failures into lessons and lessons into pizza nights.",
                "Never challenge your kid to a staring contest. They have nothing to lose.",
                "Take naps. Like a genius.",
                "When someone says, â€œYou canâ€™t do that,â€ say, â€œHold my juice box.â€",
                "Wear sunglasses inside. If you look cool enough, people wonâ€™t question it.",
                "Buy extra Halloween candy. Youâ€™re gonna need it.",
                "Always root for the underdogâ€”unless youâ€™re betting money.",
                "A spilled drink is an opportunity to mop the floor. Youâ€™re welcome.",
                "Itâ€™s okay to cry. Just pick your location wisely. (Not Costco.)",
                "A little dirt never hurt anyone. But a lot of dirt? Thatâ€™s a problem.",
                "Dinner tastes better when you eat it together. Even broccoli.",
                "Pick your battles wisely, especially with teenagers. Youâ€™ll lose anyway.",
                "â€œBecause I said soâ€ is a perfectly reasonable answer.",
                "A dad joke a day keeps the cool kids away.",
                "If you canâ€™t win, be entertaining.",
                "A family is like lasagna. Layers of love, warmth, and occasional cheese.",
                "Wear a tie when itâ€™s not required. People will think youâ€™re important.",
                "The more you laugh at life, the less life can laugh at you.",
                "Mistakes are like bruises. They hurt now, but youâ€™ll have a good story later.",
                "Sandwich crusts are optional. Love is not.",
                "If you canâ€™t be the smartest in the room, be the friendliest.",
                "Success tastes like bacon. So start cooking.",
                "Always leave room for dessert. Or regret. Your choice.",
                "Be confident, even if youâ€™re not. Fake it like bad spray tan.",
                "A good handshake can change someoneâ€™s opinion. Just donâ€™t make it clammy.",
                "Always cheer for your kidsâ€”no matter how weird the play is.",
                "Socks are the unsung heroes of life. Respect them.",
                "Shoes make the man. Slippers make him happier.",
                "Lifeâ€™s short. Buy the LEGO set.",
                "The best views in life come from the top of a Ferris wheel and the bottom of a bucket of popcorn.",
                "Donâ€™t sweat the small stuff. Or the medium stuff. Sweat only when jogging.",
                "When you lose your keys, blame the couch.",
                "Always wave at neighbors. It confuses them into liking you.",
                "A great party needs snacks, music, and zero lampshades on heads.",
                "Start every day with a winâ€”like finding matching socks.",
                "Some days youâ€™re the windshield. Some days youâ€™re the bug.",
                "Never leave a high five hanging.",
                "If youâ€™re gonna fail, fail hilariously.",
                "Confidence is 50% posture and 50% pretending you know where youâ€™re going.",
                "You can do anything with a little determination and a lot of snacks.",
                "At the end of the day, family is everything. Even when they eat the last slice of pizza."
            ];

            // --- Game Configuration ---
            const ALL_COLORS = ['#EF4444', '#22C55E', '#3B82F6', '#EAB308', '#A855F7', '#EC4899', '#F97316', '#14B8A6']; // Red, Green, Blue, Yellow, Purple, Pink, Orange, Teal
            let CODE_LENGTH = 4;
            let MAX_GUESSES = 10;
            let NUM_COLORS = 6;
            let IS_HARD_MODE = false;

            // --- DOM Elements ---
            const gameBoard = document.getElementById('game-board');
            const colorPalette = document.getElementById('color-palette');
            const submitButton = document.getElementById('submit-guess');
            const hintButton = document.getElementById('hint-btn');
            const newGameButton = document.getElementById('new-game-btn');
            const secretCodeContainer = document.getElementById('secret-code');
            const currentStreakDisplay = document.getElementById('current-streak');
            const toast = document.getElementById('toast');
            
            // Modal Elements
            const modalOverlay = document.getElementById('modal-overlay');
            const endGameModal = document.getElementById('end-game-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalNewGameButton = document.getElementById('modal-new-game');
            const modalShareButton = document.getElementById('modal-share');

            // Header Buttons
            const instructionsButton = document.getElementById('instructions-btn');
            const analyticsButton = document.getElementById('analytics-btn');
            const settingsButton = document.getElementById('settings-btn');

            // Modals
            const instructionsModal = document.getElementById('instructions-modal');
            const analyticsModal = document.getElementById('analytics-modal');
            const settingsModal = document.getElementById('settings-modal');

            // Settings Inputs
            const codeLengthSelect = document.getElementById('code-length');
            const colorCountSelect = document.getElementById('color-count');
            const hardModeToggle = document.getElementById('hard-mode');

            // Analytics Display
            const statsPlayed = document.getElementById('stats-played');
            const statsWinPct = document.getElementById('stats-win-pct');
            const statsStreak = document.getElementById('stats-streak');
            const statsMaxStreak = document.getElementById('stats-max-streak');
            const statsDistribution = document.getElementById('stats-distribution');

            // --- Game State ---
            let secretCode = [];
            let currentGuess = [];
            let currentRow = 0;
            let gameOver = false;
            let currentColors = [];
            let guessHistory = [];
            let hintUsed = false;
            let stats = {};

            // --- Functions ---
            
            function vibrate(duration) {
                if (navigator.vibrate) {
                    try {
                        navigator.vibrate(duration);
                    } catch (e) {
                        console.log("Haptics failed", e);
                    }
                }
            }
            
            function showToast(message) {
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            function loadSettings() {
                CODE_LENGTH = parseInt(localStorage.getItem('mastermindCodeLength') || '4', 10);
                NUM_COLORS = parseInt(localStorage.getItem('mastermindColorCount') || '6', 10);
                IS_HARD_MODE = (localStorage.getItem('mastermindHardMode') === 'true');

                codeLengthSelect.value = CODE_LENGTH;
                colorCountSelect.value = NUM_COLORS;
                hardModeToggle.checked = IS_HARD_MODE;
            }

            function saveSettings() {
                localStorage.setItem('mastermindCodeLength', codeLengthSelect.value);
                localStorage.setItem('mastermindColorCount', colorCountSelect.value);
                localStorage.setItem('mastermindHardMode', hardModeToggle.checked);
                
                showToast("Settings saved! They will apply on your next game.");
                closeModal();
            }

            function loadStats() {
                stats = JSON.parse(localStorage.getItem('mastermindStats')) || {
                    gamesPlayed: 0,
                    gamesWon: 0,
                    streak: 0,
                    maxStreak: 0,
                    totalTurns: 0,
                    distribution: {}
                };
                updateStreakDisplay();
            }
            
            function saveStats() {
                localStorage.setItem('mastermindStats', JSON.stringify(stats));
            }

            function updateStats(win) {
                stats.gamesPlayed++;
                if (win) {
                    stats.gamesWon++;
                    stats.streak++;
                    stats.maxStreak = Math.max(stats.streak, stats.maxStreak);
                    const turns = currentRow + 1;
                    stats.totalTurns += turns;
                    stats.distribution[turns] = (stats.distribution[turns] || 0) + 1;
                } else {
                    stats.streak = 0;
                    stats.distribution['fail'] = (stats.distribution['fail'] || 0) + 1;
                }
                saveStats();
                updateStreakDisplay();
            }
            
            function updateStreakDisplay() {
                currentStreakDisplay.textContent = stats.streak || 0;
            }

            function initGame() {
                loadSettings();
                
                currentColors = ALL_COLORS.slice(0, NUM_COLORS);
                secretCode = generateSecretCode();
                currentGuess = [];
                currentRow = 0;
                gameOver = false;
                guessHistory = [];
                hintUsed = false;

                gameBoard.innerHTML = '';
                colorPalette.innerHTML = '';
                secretCodeContainer.innerHTML = '';
                secretCodeContainer.style.display = 'none';
                modalOverlay.style.display = 'none';
                endGameModal.style.display = 'none';
                submitButton.disabled = false;
                submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
                hintButton.disabled = false;
                hintButton.classList.remove('opacity-50', 'cursor-not-allowed');

                drawBoard();
                drawPalette();
                updateActiveRow();
                updateStreakDisplay();
            }

            function generateSecretCode() {
                const code = [];
                for (let i = 0; i < CODE_LENGTH; i++) {
                    const randomIndex = Math.floor(Math.random() * currentColors.length);
                    code.push(currentColors[randomIndex]);
                }
                return code;
            }

            function drawPalette() {
                colorPalette.className = `flex flex-row flex-wrap justify-center gap-2 mb-4 p-3 bg-gray-800 rounded-lg`;
                
                currentColors.forEach(color => {
                    const colorBtn = document.createElement('button');
                    colorBtn.className = 'color-btn';
                    colorBtn.style.backgroundColor = color;
                    colorBtn.setAttribute('data-color', color);
                    colorBtn.addEventListener('click', () => handleColorClick(color));
                    colorPalette.appendChild(colorBtn);
                });
            }

            function drawBoard() {
                for (let i = 0; i < MAX_GUESSES; i++) {
                    const row = document.createElement('div');
                    row.className = 'guess-row flex items-center justify-between p-2 rounded-lg border-2 border-transparent';
                    row.id = `row-${i}`;

                    const guessPegsContainer = document.createElement('div');
                    guessPegsContainer.className = 'flex space-x-2';
                    for (let j = 0; j < CODE_LENGTH; j++) {
                        const peg = document.createElement('div');
                        peg.className = 'guess-peg w-10 h-10 md:w-12 md:h-12'; 
                        if (CODE_LENGTH === 5) peg.className = 'guess-peg w-8 h-8 md:w-10 md:h-10';
                        if (CODE_LENGTH === 6) peg.className = 'guess-peg w-7 h-7 md:w-8 md:h-8';
                        
                        peg.id = `peg-${i}-${j}`;
                        peg.addEventListener('click', () => handlePegClick(j));
                        guessPegsContainer.appendChild(peg);
                    }

                    const feedbackPegsContainer = document.createElement('div');
                    feedbackPegsContainer.className = 'feedback-peg-grid';
                    if (CODE_LENGTH === 5) {
                        feedbackPegsContainer.style.gridTemplateColumns = 'repeat(3, 1fr)';
                        feedbackPegsContainer.style.width = '33px';
                        feedbackPegsContainer.style.height = '20px';
                    }
                    if (CODE_LENGTH === 6) {
                        feedbackPegsContainer.style.gridTemplateColumns = 'repeat(3, 1fr)';
                        feedbackPegsContainer.style.width = '33px';
                        feedbackPegsContainer.style.height = '20px';
                    }

                    for (let j = 0; j < CODE_LENGTH; j++) {
                        const peg = document.createElement('div');
                        peg.className = 'feedback-peg';
                        peg.id = `feedback-${i}-${j}`;
                        feedbackPegsContainer.appendChild(peg);
                    }
                    
                    row.appendChild(guessPegsContainer);
                    row.appendChild(feedbackPegsContainer);
                    gameBoard.appendChild(row);
                }
                const rows = Array.from(gameBoard.children);
                gameBoard.innerHTML = '';
                gameBoard.append(...rows.reverse());
            }

            function handleColorClick(color) {
                if (gameOver || currentGuess.length >= CODE_LENGTH) {
                    return;
                }
                
                currentGuess.push(color);
                updateCurrentGuessPegs();
            }

            function handlePegClick(index) {
                if (gameOver || index >= currentGuess.length) {
                    return;
                }

                currentGuess.splice(index, 1);
                updateCurrentGuessPegs();
            }

            function updateCurrentGuessPegs() {
                for (let i = 0; i < CODE_LENGTH; i++) {
                    const peg = document.getElementById(`peg-${currentRow}-${i}`);
                    if (!peg) continue; 
                    if (currentGuess[i]) {
                        peg.style.backgroundColor = currentGuess[i];
                        peg.style.borderStyle = 'solid';
                        peg.style.borderColor = '#9CA3AF'; 
                    } else {
                        peg.style.backgroundColor = '#374151'; 
                        peg.style.borderStyle = 'dashed';
                        peg.style.borderColor = '#4B5563';
                    }
                }
            }
            
            function updateActiveRow() {
                document.querySelectorAll('.guess-row').forEach(row => {
                    row.classList.remove('active-row');
                });
                
                if (!gameOver) {
                    const activeRow = document.getElementById(`row-${currentRow}`);
                    if (activeRow) {
                        activeRow.classList.add('active-row');
                    }
                }
            }
            
            function validateHardMode(guess) {
                if (!IS_HARD_MODE) return true;
                
                for (const history of guessHistory) {
                    const simulatedFeedback = getFeedback(guess, history.guess);
                    if (simulatedFeedback.blackPegs !== history.feedback.blackPegs || 
                        simulatedFeedback.whitePegs !== history.feedback.whitePegs) {
                        
                        showToast(`Guess contradicts feedback from row ${guessHistory.indexOf(history) + 1}.`);
                        return false;
                    }
                }
                return true;
            }

            function handleSubmitGuess() {
                if (gameOver || currentGuess.length !== CODE_LENGTH) {
                    showToast("Your guess is not complete.");
                    return;
                }
                
                if (IS_HARD_MODE) {
                    const isGuessValid = guessHistory.every(past => {
                        const pastFeedback = past.feedback;
                        const currentFeedback = getFeedback(past.guess, currentGuess); 
                        return currentFeedback.blackPegs === pastFeedback.blackPegs &&
                               currentFeedback.whitePegs === pastFeedback.whitePegs;
                    });

                    if (!isGuessValid) {
                        vibrate(100);
                        showToast("This guess doesn't match all previous clues!");
                        return;
                    }
                }
                
                vibrate(50); 

                const feedback = getFeedback(currentGuess, secretCode);
                guessHistory.push({ guess: [...currentGuess], feedback: feedback });

                displayFeedback(feedback.blackPegs, feedback.whitePegs);

                if (feedback.blackPegs === CODE_LENGTH) {
                    vibrate(500); 
                    gameOver = true;
                    updateStats(true);
                    showEndGameModal(true);
                    revealSecretCode();
                    return;
                }

                currentRow++;
                currentGuess = [];

                if (currentRow === MAX_GUESSES) {
                    vibrate([200, 100, 200]); 
                    gameOver = true;
                    updateStats(false);
                    showEndGameModal(false);
                    revealSecretCode();
                    return;
                }

                updateActiveRow();
            }
            
            function handleHintClick() {
                if (gameOver || hintUsed || currentRow >= MAX_GUESSES - 1) {
                    let msg = "Can't use hint.";
                    if (hintUsed) msg = "Hint already used this game.";
                    if (gameOver) msg = "Game is over.";
                    if (currentRow >= MAX_GUESSES - 1) msg = "Can't use hint on the last guess.";
                    showToast(msg);
                    return;
                }

                hintUsed = true;
                hintButton.disabled = true;
                hintButton.classList.add('opacity-50', 'cursor-not-allowed');
                vibrate(100);

                let hintIndex = -1;
                if (currentGuess.length === CODE_LENGTH) {
                    for(let i=0; i < CODE_LENGTH; i++) {
                        if (currentGuess[i] !== secretCode[i]) {
                            hintIndex = i;
                            break;
                        }
                    }
                }
                
                if (hintIndex === -1) {
                    hintIndex = Math.floor(Math.random() * CODE_LENGTH);
                }

                const hintGuess = new Array(CODE_LENGTH).fill(null);
                hintGuess[hintIndex] = secretCode[hintIndex];
                
                for (let i = 0; i < CODE_LENGTH; i++) {
                    const peg = document.getElementById(`peg-${currentRow}-${i}`);
                    if (!peg) continue;
                    if (i === hintIndex) {
                        peg.style.backgroundColor = secretCode[i];
                        peg.style.border = '2px solid #EAB308'; 
                    } else {
                        peg.style.backgroundColor = '#4B5563'; 
                        peg.style.borderStyle = 'none';
                        peg.style.opacity = '0.5';
                    }
                }
                
                const feedback = getFeedback(hintGuess, secretCode);
                guessHistory.push({ guess: hintGuess, feedback: feedback });
                displayFeedback(feedback.blackPegs, feedback.whitePegs);
                
                currentRow++;
                currentGuess = [];

                if (currentRow === MAX_GUESSES) {
                    vibrate([200, 100, 200]);
                    gameOver = true;
                    updateStats(false);
                    showEndGameModal(false);
                    revealSecretCode();
                    return;
                }
                
                updateActiveRow();
                showToast("Hint used! One correct peg revealed.");
            }

            function getFeedback(guess, code) {
                let blackPegs = 0;
                let whitePegs = 0;
                
                const codeCopy = [...code];
                const guessCopy = [...guess];

                for (let i = guessCopy.length - 1; i >= 0; i--) {
                    if (guessCopy[i] && guessCopy[i] === codeCopy[i]) {
                        blackPegs++;
                        codeCopy[i] = null;
                        guessCopy[i] = null;
                    }
                }

                for (let i = 0; i < guessCopy.length; i++) {
                    if (guessCopy[i] !== null) {
                        const matchingIndexInCode = codeCopy.indexOf(guessCopy[i]);
                        if (matchingIndexInCode !== -1) {
                            whitePegs++;
                            codeCopy[matchingIndexInCode] = null;
                        }
                    }
                }

                return { blackPegs, whitePegs };
            }

            function displayFeedback(blackPegs, whitePegs) {
                let feedbackIndex = 0;
                
                for (let i = 0; i < blackPegs; i++) {
                    const peg = document.getElementById(`feedback-${currentRow}-${feedbackIndex}`);
                    if (peg) peg.style.backgroundColor = '#FFFFFF'; 
                    feedbackIndex++;
                }

                for (let i = 0; i < whitePegs; i++) {
                    const peg = document.getElementById(`feedback-${currentRow}-${feedbackIndex}`);
                    if (peg) peg.style.backgroundColor = '#DC2626'; 
                    feedbackIndex++;
                }
            }

            function revealSecretCode() {
                secretCodeContainer.innerHTML = ''; 
                secretCode.forEach(color => {
                    const peg = document.createElement('div');
                    let pegSize = 'w-8 h-8 md:w-10 md:h-10';
                    if (CODE_LENGTH === 5) pegSize = 'w-7 h-7 md:w-9 md:h-9';
                    if (CODE_LENGTH === 6) pegSize = 'w-6 h-6 md:w-8 md:h-8';
                    peg.className = `${pegSize} rounded-full border-2 border-gray-400`;
                    peg.style.backgroundColor = color;
                    secretCodeContainer.appendChild(peg);
                });
                secretCodeContainer.style.display = 'flex';
            }

            function showEndGameModal(isWin) {
                if (isWin) {
                    modalTitle.textContent = 'You Won!';
                    
                    // PICK A RANDOM MESSAGE
                    const randomMsg = victoryMessages[Math.floor(Math.random() * victoryMessages.length)];
                    
                    // Update the message HTML to include the random quote without surrounding quotation marks
                    modalMessage.innerHTML = `Congratulations, you cracked the code in ${currentRow + 1} guesses!<br><br><p class="text-yellow-400 italic text-sm">${randomMsg}</p>`;
                } else {
                    modalTitle.textContent = 'Game Over';
                    modalMessage.textContent = 'You ran out of guesses! The code has been revealed.';
                }
                
                submitButton.disabled = true;
                submitButton.classList.add('opacity-50', 'cursor-not-allowed');
                hintButton.disabled = true;
                hintButton.classList.add('opacity-50', 'cursor-not-allowed');

                document.querySelectorAll('.guess-row').forEach(row => {
                    row.classList.remove('active-row');
                });
                
                modalOverlay.style.display = 'flex';
                endGameModal.style.display = 'block';
            }
            
            function handleShare() {
                vibrate(50);
                let resultString = `Mastermind (${CODE_LENGTH} pegs, ${NUM_COLORS} colors)\n`;
                
                let turnsString = 'X';
                if (modalTitle.textContent === 'You Won!') {
                    turnsString = (currentRow + 1);
                }
                
                resultString += `Turns: ${turnsString}/${MAX_GUESSES}\n`;

                if (IS_HARD_MODE) resultString += "(Hard Mode)\n";
                resultString += "\n";

                guessHistory.forEach(item => {
                    let rowString = "";
                    rowString += "âšª".repeat(item.feedback.blackPegs);
                    rowString += "ðŸ”´".repeat(item.feedback.whitePegs);
                    rowString += "âš«".repeat(CODE_LENGTH - item.feedback.blackPegs - item.feedback.whitePegs);
                    resultString += rowString + "\n";
                });
                
                const textArea = document.createElement('textarea');
                textArea.value = resultString;
                textArea.style.position = 'fixed'; 
                textArea.style.top = '-999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast("Copied results to clipboard!");
                } catch (err) {
                    showToast("Failed to copy results.");
                }
                document.body.removeChild(textArea);
            }
            
            function showAnalyticsModal() {
                statsPlayed.textContent = stats.gamesPlayed || 0;
                const winPct = (stats.gamesPlayed > 0) ? Math.round((stats.gamesWon / stats.gamesPlayed) * 100) : 0;
                statsWinPct.textContent = winPct;
                statsStreak.textContent = stats.streak || 0;
                statsMaxStreak.textContent = stats.maxStreak || 0;

                statsDistribution.innerHTML = '';
                let maxDistribution = 0;
                for (let i = 1; i <= MAX_GUESSES; i++) {
                    const count = stats.distribution[i] || 0;
                    if (count > maxDistribution) maxDistribution = count;
                }
                const failCount = stats.distribution['fail'] || 0;
                if (failCount > maxDistribution) maxDistribution = failCount;
                if (maxDistribution === 0) maxDistribution = 1; 

                for (let i = 1; i <= MAX_GUESSES; i++) {
                    const count = stats.distribution[i] || 0;
                    const barWidth = (count / maxDistribution) * 100;
                    const bar = `
                        <div class="flex items-center space-x-2">
                            <div class="w-4 font-medium">${i}</div>
                            <div class="w-full bg-gray-700 rounded-full h-5">
                                <div class="bg-blue-600 h-5 rounded-full text-right pr-2 text-sm" style="width: ${barWidth > 8 ? barWidth : 8}%">
                                    ${count}
                                </div>
                            </div>
                        </div>
                    `;
                    statsDistribution.insertAdjacentHTML('beforeend', bar);
                }
                const failWidth = (failCount / maxDistribution) * 100;
                const failBar = `
                    <div class="flex items-center space-x-2">
                        <div class="w-4 font-medium">X</div>
                        <div class="w-full bg-gray-700 rounded-full h-5">
                            <div class="bg-red-600 h-5 rounded-full text-right pr-2 text-sm" style="width: ${failWidth > 8 ? failWidth : 8}%">
                                ${failCount}
                            </div>
                        </div>
                    </div>
                `;
                statsDistribution.insertAdjacentHTML('beforeend', failBar);

                modalOverlay.style.display = 'flex';
                analyticsModal.style.display = 'block';
            }
            
            function closeModal() {
                modalOverlay.style.display = 'none';
                instructionsModal.style.display = 'none';
                settingsModal.style.display = 'none';
                analyticsModal.style.display = 'none';
                endGameModal.style.display = 'none';
            }

            // --- Event Listeners ---
            submitButton.addEventListener('click', handleSubmitGuess);
            hintButton.addEventListener('click', handleHintClick);
            newGameButton.addEventListener('click', initGame);
            modalNewGameButton.addEventListener('click', () => {
                closeModal();
                initGame();
            });
            modalShareButton.addEventListener('click', handleShare);
            
            instructionsButton.addEventListener('click', () => {
                modalOverlay.style.display = 'flex';
                instructionsModal.style.display = 'block';
            });
            analyticsButton.addEventListener('click', showAnalyticsModal);
            settingsButton.addEventListener('click', () => {
                modalOverlay.style.display = 'flex';
                settingsModal.style.display = 'block';
            });
            
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    closeModal();
                }
            });
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', closeModal);
            });
            
            codeLengthSelect.addEventListener('change', saveSettings);
            colorCountSelect.addEventListener('change', saveSettings);
            hardModeToggle.addEventListener('change', saveSettings);

            // --- Start Game ---
            loadStats();
            initGame();
        });
    </script>
</body>
</html>
